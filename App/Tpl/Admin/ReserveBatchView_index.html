<!DOCTYPE html>
<html lang="en">

	<head>
    	<meta charset="UTF-8" />
		<title>会议室长期预约</title>
		<include file='App/Tpl/Common/csslist.html' />	
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<script src="__PUBLIC__/js/modernizr.js"></script>
		<link href="__PUBLIC__/vendor/jquery-datatables-bs3/css/datatables.css" rel="stylesheet"/>
		<include file='App/Tpl/Common/header_admin.html'/>	
		<style type="text/css">
			#mytable_paginate a{
				color:#777
			  }
			  .paginate_button{
				  margin-right:20px;
			  }
		</style>
	</head>
	
	<body>
         
		<div class="container-fluid content">	
			<div class="row">
                <include file='App/Tpl/Common/sidebar_admin.html'/>
				<div class="main ">
					
					<div class="page-header">
						<div class="pull-left">
							<ol class="breadcrumb visible-sm visible-md visible-lg">								
								<li><a><i class="icon fa fa-home"></i>主页</a></li>
								<li class="active"><i class="fa fa-laptop"></i>会议室长期预约情况</li>
							</ol>						
						</div>

						<div class="pull-right">
							<h2>会议室长期预约</h2>
						</div>					
					</div>
					<div class='panel panel-default bk-bg-white'>
								<div class='panel-heading bk-bg-white'>
									<h6><i class='fa fa-indent red'></i>长期预约信息添加</h6>							
									<div class='panel-actions'>
										<a href='#' class='btn-minimize'><i class='fa fa-caret-up'></i></a>
										<a href='#' class='btn-close'><i class='fa fa-times'></i></a>
									</div>
								</div>
								<div class='panel-body' style=''>
									<form id="myform" method='post' enctype='multipart/form-data' class='form-horizontal '>
									<div class='form-group'>
											<label class='col-md-3 control-label' for='text-input'>预约人</label>
											
											<div class='col-md-9'>
												<input type='text' id='number' name='house_id' class='form-control'  required="required">
											</div>
										</div>
									    <div class="form-group" >
											<label class="control-label col-md-3" for="select">会议室名称</label>
											<div class="col-md-9">
												<select id="housename" name="time_select1" class="form-control" size="1" required="required">
													<foreach name="allhouse" item="b">
														<option value={$b['house_id']}>{$b['house_name']}</option>
                                   
                                                </foreach>
												<!--	<option value="0">请选择会议室</option>
													<option value="210">大数据讨论室</option>
													<option value="211">大数据讨论室2</option>-->
													
												</select>
											</div>
										</div>
										
										<div class="form-group">
											<label class="col-md-3 control-label">预约日期</label>
										

											<div class="col-md-6">
												<div class="input-daterange input-group" data-plugin-datepicker>
													<span class="input-group-addon">
														<i class="fa fa-calendar"></i>
													</span>
													<input id="sdate" type="text" class="form-control" name="start" required="required"/>
													<span class="input-group-addon">to</span>
													<input id="edate" type="text" class="form-control" name="end" required="required"/>
												</div>
											</div>
										</div>
										
										<div class="form-group" >
											<label class="control-label col-md-3" for="select">请选择</label>
											<div class="col-md-9">
												<select id="weekday" name="time_select1" class="form-control" size="1" required="required">
													<option value="1">星期一</option>
													<option value="2">星期二</option>
													<option value="3">星期三</option>
													<option value="4">星期四</option>
													<option value="5">星期五</option>
													<option value="6">星期六</option>
													<option value="0">星期日</option>
												</select>
											</div>
										</div>
										<div class="form-group" >
											<label class="control-label col-md-3" for="select">起始时间</label>
											<div class="col-md-9">
												<select id="stime" name="time_select1" class="form-control" size="1" required="required">
													<option value="0">请输入起始时间</option>
													<option value="0">8:00</option>
													<option value="1">8:30</option>
													<option value="2">9:00</option>
													<option value="3">9:30</option>
													<option value="4">10:00</option>
													<option value="5">10:30</option>
													<option value="6">11:00</option>
													<option value="7">11:30</option>
													<option value="8">12:00</option>
													<option value="9">12:30</option>
													<option value="10">13:00</option>
													<option value="11">13:30</option>
													<option value="12">14:00</option>
													<option value="13">14:30</option>
													<option value="14">15:00</option>
													<option value="15">15:30</option>
													<option value="16">16:00</option>
													<option value="17">16:30</option>
													<option value="18">17:00</option>
													<option value="19">17:30</option>
													<option value="20">18:00</option>
													<option value="21">18:30</option>
													<option value="22">19:00</option>
													<option value="23">19:30</option>
													<option value="24">20:00</option>
													<option value="25">20:30</option>
													<option value="26">21:00</option>
													<option value="27">21:30</option>
												</select>
											</div>
										</div>
										<div class="form-group" >
											<label class="control-label col-md-3" for="select">结束时间</label>
											<div class="col-md-9">

												<select id="etime" name="time_select1" class="form-control" size="1" required="required">
													<option value="0">请输入结束时间</option>
													<option value="1">8:30</option>
													<option value="2">9:00</option>
													<option value="3">9:30</option>
													<option value="4">10:00</option>
													<option value="5">10:30</option>
													<option value="6">11:00</option>
													<option value="7">11:30</option>
													<option value="8">12:00</option>
													<option value="9">12:30</option>
													<option value="10">13:00</option>
													<option value="11">13:30</option>
													<option value="12">14:00</option>
													<option value="13">14:30</option>
													<option value="14">15:00</option>
													<option value="15">15:30</option>
													<option value="16">16:00</option>
													<option value="17">16:30</option>
													<option value="18">17:00</option>
													<option value="19">17:30</option>
													<option value="20">18:00</option>
													<option value="21">18:30</option>
													<option value="22">19:00</option>
													<option value="23">19:30</option>
													<option value="24">20:00</option>
													<option value="25">20:30</option>
													<option value="26">21:00</option>
													<option value="27">21:30</option>
													<option value="28">22:00</option>
												</select>
											</div>
										</div>
									<div class='form-group'>
											<label class='col-md-3 control-label' for='text-input'>申请人电话号码</label>
											<div class='col-md-9'>
												<input id="tel" type='text' id='id2' name='house_name' class='form-control' placeholder='选填'>
												<span class='help-block'></span>
											</div>
										</div>
										<div class='form-group'>
											<label class='col-md-3 control-label' for='text-input'>申请人邮箱</label>
											<div class='col-md-9'>
												<input id="email" type='text' id='id2' name='house_name' class='form-control' placeholder='选填'>
												<span class='help-block'></span>
											</div>
										</div>
									<!--	<div class='form-group'>
											<label class='col-md-3 control-label' for='text-input'>申请人姓名</label>
											<div class='col-md-9'>
												<input id="name" type='text' id='id2' name='house_name' class='form-control' >
												<span class='help-block'></span>
											</div>
										</div>-->
										<div class='form-group'>
											<label class='col-md-3 control-label' for='text-input'>申请理由</label>
											<div class='col-md-9'>
												<input id="reason" type='text' id='id2' name='house_name' class='form-control' placeholder='选填' >
												<span class='help-block'></span>
											</div>
										</div>
										<!--div class='form-group'>
											<label id="firm"class='col-md-3 control-label' for='text-input'>申请单位</label>
											<div class='col-md-9'>
												<input type='text' id='id2' name='house_name' class='form-control' placeholder='选填' >
												<span class='help-block'></span>
											</div>
										</div-->
									<div style='margin-left:390px;'>
									<button id='mybutton' type='submit' class='bk-margin-5 btn btn-danger' style='margin-left:250px'>提交</button>
									</div>
									
										<br>
									</form>
								</div>								
							</div>
                

                        <div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="panel panel-default bk-bg-white">

								<div class="panel-heading bk-bg-white">
									<h6><i class="fa fa-table red"></i>
										<span class="break">会议室长期预约情况</span>					
									</h6>
									<div class="panel-actions">
										<a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>
										<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
									</div>				
								</div>
								<div class="panel-body">
									<table class="table table-bordered table-striped mb-none" id="mytable">
                                            <thead>
                                                <tr>
                                                    <th>开始日期</th>
                                                    <th>结束日期</th>
                                                    <th>星期几</th>
                                                    <th>预约时间段</th>
                                                    <th>申请人</th>
                                                    <th>会议室</th>
													<th>邮箱</th>
													<th>电话</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                               <foreach name="backinfo" item="b">
                                                    <tr>
                                                        <td>{$b['s_date']}</td>
                                                        <td>{$b['e_date']}</td>
                                                        <td>{$week[$b['day']]}</td>
                                                        <td>{$time_list[$b['s_time']]}-{$time_list[$b['e_time']]}</td>
                                                        <td>{$b['m_name']}</td>
														<td>{$b['house_name']}</td>
														<td>{$b['email']}</td>
														<td>{$b['telno']}</td>
                                                    </tr>
                                                </foreach>
										    </tbody>
									    </table>    
									 
								</div>
							</div>
						</div>
					</div>	

				<!-- End Main Page -->			
		
			 
			
			</div>
		</div><!--/container-->
			
		
		<div class="clearfix"></div>		
		
		
		<!-- start: JavaScript-->
     
        
        <include file='App/Tpl/Common/footer.html'/>
		<include file='App/Tpl/Common/jslists.html'/>
		<script src="__PUBLIC__/js/bootstrap-datepicker.js"></script>
		<script src="__PUBLIC__/js/pages/index.js"></script>
		<script src="__PUBLIC__/vendor/jquery-datatables-bs3/js/jquery.dataTables.min.js"></script>
		<script>
			$("#mytable").DataTable({
                    "paging": true,
                    "iDisplayLength": 10, //默认每页数量
                    "bPaginate": true, //翻页功能
                    "bLengthChange": false, //改变每页显示数据数量
                    "bFilter": false, //过滤功能
					"bInfo": true, //页脚信息
	                "bAutoWidth": true, //自动宽度
                    "bRetrieve": true,
                    "processing": true,
                    //"ordering": false,
					//"bSort": false, 
			        //"serverSide" : true,//服务器端进行分页处理的意思
                    //"bPaginate": true,
                    //"bProcessing": true
                    columns : [{data : "id"},{data:"value"},{data:"value2"},{data:"value3"},{data:"value4"},{data:"value5"},{data:"value6"},{data:"value7"}],
            });
			function get_day(string){
				var myarray=string.split('/');
				var date=myarray[2]+'-'+myarray[0]+'-'+myarray[1];
				return date;
			}
			$(document).ready(function() {
            $("#mybutton").click(function() {
            	var number=$("#number").val();
            	var housename=$("#housename").val();
            	var sdate1=$("#sdate").val();
            	var sdate=get_day(sdate1);
            	//alert(sdate);
            	var edate2=$("#edate").val();
            	var edate=get_day(edate2);
            	var weekday=$("#weekday").val();
            	var stime=$("#stime").val();
            	var etime=$("#etime").val();
            //	var name=$("#name").val();
            	var tel=$("#tel").val();
            	var email=$("#email").val();
            	var reason=$("#reason").val();
            	//var firm=$("#firm").val();
				if(!number||!housename||!sdate1||!edate2||!weekday||!stime||!etime)
            	{	
					return;
				}
            	$.post("{:U('Admin/ReserveBatchView/insert_date')}",{p_number:number,p_housename:housename,p_sdate:sdate,p_edate:edate,p_weekday:weekday,p_stime:stime,p_etime:etime,p_tel:tel,p_email:email,p_reason:reason/*,p_firm:firm*/},function(data){
            		//alert(data)
					console.log(data);
					if(data.status==1){
						alert("提交成功");
						CAR(3);
            		} 
            		else if(data.status==0){
            			alert("提交失败,错误代码："+data.status);
            		}
					/*else if(data.status==4){
						console.log(data);
						alert("学工号错误，不存在该用户！");
					}*/
					else if(data.status==3){
						alert("起始时间不能大于或等于结束时间！");
					}
					else if(data.status==2){
						alert("起始日期不能大于或等于结束日期！");
					}
					else if(data.status==5)
					{
						console.log(data);
						alert(data.wrongdate+"的时间段"+data.wrongtime+"已被占用");
					}
            	});

            });
            });
		</script>

		<!-- end: JavaScript-->
		
	</body>
	
</html>
